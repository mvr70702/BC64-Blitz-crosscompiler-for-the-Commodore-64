/*******************************************************************************
* bc_data.c
*******************************************************************************/

#include       <stdio.h>
#include       <ctype.h>
#include       "bc.h" 

/*******************************************************************************
* Vars
*******************************************************************************/

U8             Data[32768];            // DATA items
int            iData;
int            nDataItems;


/*******************************************************************************
* void DataInit(void)
*******************************************************************************/

void DataInit(void)
{
  iData   = 0;
  nDataItems = 0;
}  
  
/*******************************************************************************
* void DataGen(U8 b)
*******************************************************************************/

void DataGen(U8 b)
{
  if (Pass == 1)
  {
    Data[iData] = b;
    iData++;
  }
}

/*******************************************************************************
* void DataPatch(int Addr,U8 b)
*******************************************************************************/

void DataPatch(int Addr,U8 b)
{
  if (Pass == 1)
  {
    Data[Addr] = b;
  }
}

/*******************************************************************************
* int DataGetIndex(void)
*******************************************************************************/

int DataGetIndex(void)
{
  return iData;
}

/*******************************************************************************
* void DataNewitem(void)
* Bump counter, keep track of nr. dataitems
*******************************************************************************/

void DataNewitem(void)
{
  if (Pass == 1)
    nDataItems++;
}

/*******************************************************************************
* void  DataGenDataSection(int *pIx)
* Write Data section to Pdata, at pIX. Update pIX
*******************************************************************************/

void  DataGenDataSection(int *pIx)
{
  int          i;
  
  for (i=0; i<iData; i++)
  {
    Pdata[*pIx] = Data[i];
    (*pIx)++;
  }  
}

/*******************************************************************************
* void DataDump(void)
*******************************************************************************/

void DataDump(void)
{
  int          i,p,l;
  U8           buff[80];
  
  List("DATA Section %4d items, size = %4d\n",nDataItems,iData);
  p = 0;
  for (i=0; i<nDataItems; i++)
  {
    l = (int)Data[p];                       // count of string following
    p++;
    strncpy(buff,&Data[p],l);
    buff[l]=0x00;
    List("%3d %s\n",l,buff,iData);
    p += l;
  }
  ListCR();
}
